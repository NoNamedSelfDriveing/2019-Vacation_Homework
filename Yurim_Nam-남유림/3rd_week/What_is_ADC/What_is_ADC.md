# What is ADC

## ADC
ADC란, **Analog to Digital Converter(아날로그-디지털 변환 회로)**의 줄임말로, **아날로그 신호를 디지털 신호로 변환해주는 기능**을 말한다. 즉, 아날로그 신호가 들어오면 이를 샘플링하여 양자화와 부호화의 과정을 거쳐 디지털 신호로 변환하는 것이다. 이렇게 변환해 주는 이유는 **디지털 신호가 아날로그 신호보다 신호를 처리하기에 훨씬 편하고, 조작이나 저장의 편리성 등이 뛰어나기 때문**이다. 

## ATmega128 ADC
아트메가128에서는 ADC의 측정 범위를 기본적으로 프로세서의 동작전압을 기준으로 한다. 이는 ADMUX레지스터로 설정이 가능하다. 또한, 아트메가128에서 ADC는 총 두 가지의 상태(단일 변환 모드, 연속 변환 모드)가 있다.

> 프로세서의 동작전압이 5v이면 0~5v의 신호 범위가 되며 이 범위를 10비트의 범위로 인식하게 된다.

## 단일 변환 모드
단일 변환 모드(Single Conversion Mode)는 쉽게 말하여 **한 번씩 변하는 모드**이다. 

- ADSCRA 레지스터의 ADSC를 1로 설정함으로서 시작됨
- 변환이 끝나면 0이 되어 인터럽트 발생
- AD변환 중 입력 채널이 변경된다면 현재의 변환을 마치고 새로 변환된 채널로 변경됨

## 연속 변환 모드
연속 변환 모드(free running mode, 자유 동작 모드라고도 함)는 단일 변환 모드와 반대로 **연속해서 변화하는 모드**이다.

- ADSCRA 레지스터의 ADFR를 1로 설정함으로서 ADC는 지속적으로 샘플링과 변환을 수행함
- 그 결과로 ADC 레지스터를 갱신

## 레지스터 설정

### ADMUX
ADMUX는 초기 세팅을 담당하며, ADMUX 레지스터는 크게 세 파트로 나뉘어져 있다.

#### REF
REF는 reference selection bits의 줄임말로, ADC가 어떠한 전원 공급원을 사용할 것인지 선택한다. 비트는 6, 7 비트를 사용하며, ADC 도중에 변경이 된다면, 현재 변환 과정이 끝나야 적용이 된다.

| REFS1 | REFS0 | Voltage Reference Selection                         |
| ----- | ----- | --------------------------------------------------- |
| 0     | 0     | 내부 verf를 끄고 전체 전원을 공급                     |
| 0     | 1     | AVCC - AREF 핀에 외부 콘덴서 장착                    |
| 1     | 0     | reserved                                            |
| 1     | 1     | 내부의 verf인 2.56V를 사용                           |

#### ADLAR
ADLAR은 ADC Left Adjust Result의 줄임말로, ADC 데이터를 좌측 혹은 우측부터 받을 것을 결정한다. 그 이유는 아트메가는 8비트를 사용하기 때문에 데이터를 받을 수 있는 공간은 8개 밖에 없는데, ADC는 10비트이기 때문이다. 그래서 8비트를 두 번에 나누어 ADC 데이터를 받는다.

![](https://2018.robotix.in/img/tutorial/avr/adc/adlar.png)

위의 그림을 보면 차이를 확실히 알 수 있다. ADLAR이 0인 상태에서는 우측부터 데이터가 들어와 ADCH가 두 개 들어가고 ADCL이 모두 채워진 모습을 볼 수 있다. <br>
반면에 ADLAR이 1인 상태는 좌측부터 데이터가 들어가 ADCH가 모두 채워진 상태이고 ADCL이 두 개 들어가있는 모습을 볼 수 있다. <br>
여기서의 ADCH는 **ADC의 High를 의미**하고, ADCL은 **LOW를 의미**한다.

#### MUX
MUX는 multiplexer라는 단어에서 나온 의미이다. <br>
멀티플렉서는 여러 개의 입력선들 중에서 하나를 선택해 단일 출력선으로 연결하는 조합회로인데, MUX는 이와 같은 역할을 한다. 

> 예를 들어 4개의 입력이 있다고 한다면, 그 중 하나를 선택하여 내보내는 것이다.

![](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRogz3Vxgc29oW5AvmMIMp6gdUro8NLs09RS4MJ3_BEV9_nKMxZ)

ATmegr128의 데이터시트를 보면 MUX0~MUX4 총 5개의 번호가 있고 ADC를 무엇을 사용할 것인지 핀을 가르쳐준다. 한 마디로, 채널을 선택해주는 파트인 것이다.

### ADCSRA
ADCSRA는 구체적인 동작을 담당하며, 여섯 가지 부분으로 나뉘어져 있다.

#### ADEN
이는 ADC를 허용할 것인지 말 것인지를 결정한다. ADC를 허용하고 싶으면 1을, 허용하고 싶지 않으면 0을 설정한다.

#### ADSC
이는 ADC 시작 유무를 확인해준다. 현재 상태의 읽어둔 값을 읽어오는 기능인데, 타이머와 같이 사용하여 원하는 시간마다 읽어올 수 있게 해준다. 변환이 끝나면 자동으로 0으로 바뀐다.

#### ADFR
이는 앞서 설명했던 모드를 설정하는 것인데, 0이면 단일 변환 모드를, 1이면 연속 변환 모드를 실행한다.

#### ADIF
이는 ADC가 끝나고 Data Register에 값이 들어왔을 때 1로 바뀐다. interrupt flag 역할을 한다.

#### ADIE
이는 inerrupt를 허용하는 역할을 한다. 1이면 허용, 0이면 비허용이다.

#### ADPSn
이는 ADC의 division factor를 결정해주는 비트이다. 